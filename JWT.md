# JSON Web Token(JWT)

- [wiki](https://en.wikipedia.org/wiki/JSON_Web_Token)
- [公式](https://jwt.io/)

## What is JSON Web Token?

JWTは、
> - JSONオブジェクトとして当事者間で情報を安全に伝送するコンパクトで自立的な方法を定義するオープンスタンダード（RFC 7519）
> - やりとりされる情報はデジタル署名されているため、検証および信頼することがでる
> - sercret（HMACアルゴリズムを使用）またはRSAまたはECDSAを使用する公開鍵/秘密鍵のペアを使用して署名できる
> - 暗号化して当事者間の秘密を提供することもできるが、署名付きトークンに焦点を当ている

JWTの署名されたトークンは、
> - その中に含まれるclaimの完全性を検証することができる
> - 他の当事者からクレームを隠すことができる
> - トークンが公開鍵/秘密鍵のペアを使用して署名されている場合、署名はまた、秘密鍵を保持する当事者だけが署名したものであることを証明する

## When should you use JSON Web Tokens?

**認可**
> - これはJWTを使用するための最も一般的なシナリオ
```
1. ユーザーがログインすると、その後の各要求にJWTが含まる
2. ユーザーはそのトークンで許可されているルート、サービス、リソースにアクセスできる
```
> - シングルサインオンは、オーバーヘッドが小さく、異なるドメイン間で簡単に使用できるため、JWTを広く使用する機能です。

**情報交換**
> - 当事者間で情報を安全に伝達するための良い方法
> - JWTには、公開鍵/秘密鍵のペアを使用して署名することができるため、送信者は自分が誰であるかを確認できる
> - さらに、ヘッダーとペイロードを使用して署名が計算されるので、コンテンツが改ざんされていないことを確認することもできる

## What is the JSON Web Token structure?

JWTは、ドット(.)で区切られた3つの部分で構成されてる
> - ヘッダ
> - ペイロード
> - 署名

したがって、JWTは通常次のようになる
```
xxxxx.yyyyy.zzzzz
```
ヘッダとペイロードはBase64Urlでエンコードされる

**ヘッダ**
2つの部分で構成される
> - JWTのトークンのタイプ
> - HMAC SHA256やRSAなどのハッシングアルゴリズム

**ペイロード**
> - claimを含んでいる

claimは、
> - エンティティ（通常は、ユーザー）と追加データに関するステートメント
> - 3種類ある
```
- registered
- public
- private
```

**- Registered claims**
- 必須ではないが
- 推奨される一連の事前定義されたclaim
含める情報は
```
iss ・・・発行者 issuer
exp ・・・有効期限 expiration time
sub ・・・件名 subject
aud ・・・audience
とか
```

**- Public claims**
- 使用している人が自由に定義できる
- 衝突を避けるためには、 
```
IANA JSON Webトークンレジストリで定義するか、衝突抵抗ネームスペースを含むURIとして定義する必要がある
```

**- Private claims**
- 使用に同意した当事者間で情報を共有するために作成されたカスタム claim
- Registered claimまたはpublic claimではない

こんな感じ
```
{
  "sub": "1234567890",
  "name": "John Doe",
  "admin": true
}
```

* 署名付きトークンの場合、この情報は改ざんから保護されていますが、誰でも読むことができます。暗号化されていない限り、秘密情報をJWTのペイロードまたはヘッダー要素に入れないでください。

**署名**
> - 署名部分を作成するには、コード化されたヘッダー、コード化されたペイロード、秘密、ヘッダーで指定されたアルゴリズム、およびそれに署名する必要がある

たとえば、HMAC SHA256アルゴリズムを使用する場合、署名は次のように作成されます。
```
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret)
```